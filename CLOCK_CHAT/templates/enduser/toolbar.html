<!DOCTYPE html>
<html lang="en">
    <head>
        {% load static %}
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{% block title %}{% endblock %}</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
        <link rel="icon" type="image/png" href="{% static 'images/admin-lock.jpeg' %}">

        <link rel="stylesheet" href="/static/css/clock.css">
        <script src="/static/js/toolbar.js"></script>

        {% block extra_css %}
        {% endblock %}
        {% block extra_js %}
        {% endblock %}
        <meta name="csrf-token" content="{{ csrf_token }}">

    </head>
    


<body data-user-id="{{ request.user.id }}" style="overflow-y:hidden;">

<div class="toolbar">
    <div class="toolbar-icons">
        <span class="toolbar-icon active" data-tooltip="Chats" onclick="window.location.href='/chat/'"><i class="fas fa-comment-alt"></i></span>
        <span class="toolbar-icon" data-tooltip="Status" onclick="window.location.href='/status/'"> <i class="fas fa-circle-notch"></i></span>
    </div>
    <div class="toolbar-icons">
        <span class="toolbar-icon" data-tooltip="Settings"><i class="fas fa-cog"></i></span>
        <span class="toolbar-icon" data-tooltip="Profile" onclick="profile_modal()"><i class="fa-regular fa-user"></i></span>
    </div>
</div>




<!-- Viewer Modal -->
<div id="profileModal" class="profile-modal" style="display: none;">
  <div class="profile-modal-box profile-modal-content">
    
    <div class="profile-header text-center">
      <img id="profilePhoto" src="/static/images/default_avatar.png" alt="Profile Photo">
      <h2 id="fullName"></h2> <!-- Read-only name display -->
    </div>
    <div class="profile-info">
      <h4>
        Bio
      </h4>
      <input id="about" type="text" readonly onclick="editField('about')">
    
      <h4>
        Date of Birth
      </h4>
      <input id="dob" type="date" readonly onclick="editField('dob')">
    
      <h4>
        Gender
      </h4>
      <input id="gender" type="text" readonly onclick="editField('gender')">
    
      <h4>Joined</h4>
      <input id="dateJoined" type="text" readonly onclick="editField('dateJoined')">
    </div>
    
    <script>
      const originalValues = {};
    
      function editField(fieldId) {
        console.log(fieldId);
        const input = document.getElementById(fieldId);
    
        // Store original value
        originalValues[fieldId] = input.value;
        console.log("Editing " + fieldId);
    
        // Make editable and focus
        input.removeAttribute("readonly");
        input.focus();
    
        // Listen for Enter key to submit data
        const onEnter = (e) => {
          if (e.key === "Enter") {
            console.log("Enter pressed");
    
            e.preventDefault();
    
            const newValue = input.value;
    
            // Perform the fetch request to update the backend
            fetch("/profile/update/", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": getCSRFToken(),
              },
              body: JSON.stringify({
                field: fieldId,
                value: newValue,
              }),
            })
              .then((res) => res.json())
              .then((data) => {
                if (!data.success) {
                  alert("Update failed: " + data.message);
                  input.value = originalValues[fieldId]; // Revert to the original value
                }
                input.setAttribute("readonly", true); // Set input back to readonly
              })
              .catch((error) => {
                alert("Error: " + error.message);
                input.value = originalValues[fieldId]; // Revert to the original value
                input.setAttribute("readonly", true); // Set input back to readonly
              });
    
            input.removeEventListener("keypress", onEnter);
          }
        };
    
        input.addEventListener("keypress", onEnter);
      }
    
      function getCSRFToken() {
        return document.cookie
          .split("; ")
          .find((row) => row.startsWith("csrftoken="))
          ?.split("=")[1];
      }
    </script>
    

    <button class="logout-btn" onclick="window.location.href='/logout/'">Log out</button>
    <p class="logout-note">Chat history on this computer will be cleared when you log out.</p>
  </div>
</div>

</div>


{% block content %}

{% endblock %}
</body>
</html>